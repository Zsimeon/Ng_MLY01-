# 15、在误差分析时并行的评估多个方法

你的团队对于提升猫咪检测器有一些想法：

- 修改你的算法把狗当作猫的问题
- 修改你的算法中把大型猫科动物（狮子猎豹）当作小猫（宠物猫）的错误。
- 提升系统对于模糊图片的性能
- 其他

你可以并行的对所有的这些方法进行有效评估。我通常创造一个表格并在看100个错误分类的开发集图像时
填充它，我也摘下来一些可能对我有帮助来记住特殊例子的注释。为了解锁这个过程，让我们来看看一个
你在处理四个例子的小开发集时可能会做出来的电子表格:

---------------------------------------------------------------------------
Image        |    Dog    |    Great cat   |  Blurry  |   Comments
----------------------------------------------------------------------------
  1			 |     √     |                |          | Unusual pitbull color
----------------------------------------------------------------------------
  2			 |           |                |     √    |
 ---------------------------------------------------------------------------
  3			 |           |       √        |     √    | Lion;picture taken at
                                                         zoo on rainy day
----------------------------------------------------------------------------   
  4			 |           |       √        |          | Panther behind tree
----------------------------------------------------------------------------
 % of total  |    25%    |       50%      |    50%   |
----------------------------------------------------------------------------

第3幅图片同时有大型猫和模糊图片列。更进一步的说，因为对于一个样例可能和多个分类有关，最底部的百分数总和
可能不能加起来为100%。
尽管你可能首先把这些分类（狗，大猫）用公式表示，而不是手动分类这些例子，实际上，一旦你开始看这所有的例子，
你可能会被启发提出一个新的误差类别。例如，你看完一堆图片并意识到许多的错误发生在有Instagram滤镜的图片上。
你能返回去并在表单中添加一个新的“Instagram”列。人工的看这些算法误分类的例子，并判断人类怎么正确标记这些
图片会经常启发你找到新的错误种类和解决方法。

最有帮助的错误种类会是你有想法去提升的那个。例如，这个Instagram种类在当你有想法去“撤销”滤镜并还原图片的时候
可能是最有帮助的去添加上的。但是你不必限制住你自己仅仅在你知道怎么去提升的误差分类上。这个过程的目的是
构建一个你的关于最有前景领域的直觉。

误差分析是一个不断重复的过程。如果你一开始在脑海中没有分类的时候也不要担心。在看一些图片之后，你可能会
有一些误差类别的想法。在人工的分类一些图片之后，你可能想到新的类别和在较少的新类别之下重新检测图片等等。

假设你结束了尝试误差分析在100个误分类开发集样例上并得到如下表格：

---------------------------------------------------------------------------
Image        |    Dog    |    Great cat   |  Blurry  |   Comments
----------------------------------------------------------------------------
  1			 |     √     |                |          | Unusual pitbull color
----------------------------------------------------------------------------
  2			 |           |                |     √    |
 ---------------------------------------------------------------------------
  3			 |           |       √        |     √    | Lion;picture taken at
                                                         zoo on rainy day
----------------------------------------------------------------------------   
  4			 |           |       √        |          | Panther behind tree
----------------------------------------------------------------------------
  ...        |    ...    |       ...      |    ...   |  ...
----------------------------------------------------------------------------
 % of total  |     8%    |       43%      |    61%   |
----------------------------------------------------------------------------

你现在知道做关于狗的误分类的工程最多可以消除8%的误差。在大猫和模糊图片误差上的工作可以消除更多的误差。
因此，你可能选择后两个类别中的一个来关注。如果你的团队有足够多的人并行的处理多方向，你可以让一些工程师
来处理大型猫，其他的来做模糊图片。

误差分析不会产生一个死板的数学公式来告诉你应该做的最高优先任务。你也应该计算你想要在不同的类别上达到的成果，
和处理每一个需要花费的时间。






# 16、清除误标记开发集和测试集样例

在误差分析时，你可能会注意到一些你的开发集中的样例被误标记了。我这里说的“误标记”实际这个图片在算法
对他进行处理之前就已经被人工标记者错误标记了。即，样例(x,y)中的label类有错误的y值。例如，可能一些图片并没有
猫，但是被错误标记为含有猫，或正相反。如果你认为这些被误标记的图片是有意义的，添加一个类别来
保持对误标记样例的观察：

------------------------------------------------------------------------------------------------------
Image        |    Dog    |    Great cat   |  Blurry  |   Mislabeld   |   Comments
------------------------------------------------------------------------------------------------------
  ...		 |           |                |          |               |
------------------------------------------------------------------------------------------------------
  98     	 |           |                |          |      √        |Labeler missed cat in background
 -----------------------------------------------------------------------------------------------------
  99 		 |           |       √        |     √    |               | 
------------------------------------------------------------------------------------------------------
  100		 |           |                |          |      √        | Drawing of cat; not a real cat
------------------------------------------------------------------------------------------------------
 % of total  |    8%     |       43%      |    61%   |      6%       |
------------------------------------------------------------------------------------------------------

你应该改正你开发集中的标签么？记住开发集的目标是帮你快速的评估算法来使得你可以判断算法A或者B更好。
如果开发集的部分被错误标记阻碍你做这些判断的话，那么花费时间来修改误标记的开发集标签是值得的。

例如，假设你的分类器性能是：
- 开发集中整体准确率............90%(10%的整体误差)
- 因为误标记样例导致的误差......0.6%(6%的开发集误差)
- 其他原因导致的误差............9.4%(94%的开发集误差)

在这里，由误标记导致的0.6%的不准确率和你能提高的9.4%的误差可能不是足够有意义的相关的。
在这里手动的修改开发集中误标记图片是无害的，但是这么做也不是很重要：当不知道是否你的系统有10%或9.4%的总体误差
时是可以的。

假设你保持提升猫咪分类器并达到了下面的性能：
- 开发集中整体准确率............98%(2%的整体误差)
- 因为误标记样例导致的误差......0.6%(30%的开发集误差)
- 其他原因导致的误差............1.4%(70%的开发集误差)

你的误差的30%来自于开发集图像，给你的准确率评估带来了显著的误差。这时候值得来提高开发集中标签的质量。
处理误标记样例会帮助你搞清楚如果分类器误差接近1.4%或2%-一个明显的相关的错误。

忍受一些误标记的开发测试集样例并不是罕见的，只是后来在系统提升时，改变你的想法，
误标记样例的比例随着整体误差集增长。

最后一节解释你在算法提升时能做哪些来改进误差类别，例如狗，大猫和模糊。你在这一章学到的也能在误标记类别中用
，在改进数据标签的时候。

无论什么过程你用来修改开发集标签，记住也把它用到测试集以至于你的开发集和测试集继续来自于同一分布。同时修改
你的开发和测试集会避免我们在di6节讨论过的问题，你的团队优化的开发集性能会在随后被有着不同准则的不同测试集
所评判。

如果你打算提升标签质量，考虑再次确认你的系统误分类的样例标签和他正确分类的样例标签。原始标签和你学习算法都
有可能在一个样例上出错。如果你只修改你的系统误分类的样例标签，你可能会给你的估计带来偏差。
如果你有1000个开发集样例，如果你的分类器有98%的准确率，检查20个它误分类的样例比检测正确分类的98%个样例更轻松。
因为它实际上在只检查误分类样例的时候更容易，偏差在一些开发集缓慢移动。这个偏差是可接受的，当你在只关注开发一个
产品或应用时，但是当你打算用这个结果在学术研究论文或需要一个完全无偏差的测试集测量准确率时是一个问题。


# 17、如果你有一个大的开发集，把它分成两个子集，你只关注其中一个

假设你有一个大的5000个样例的20%错误率的开发集。因此，你的算法误分类了1000个开发集图片。人工检查1000个图片
会耗费很长时间，因此，我们应该考虑在误差分析时不全部使用它们。

在这个例子中，我会确切的把这个开发集分成两个子集，你关注其中一个，另一个不关注。你会更快的过拟合你人工关注的那个。
你能使用你不关注的那个来调节参数。

让我们继续我们上面的例子，该算法对5000个开发集中有1000个误分类的例子。假设我们想要人工的为误差分析检测100个错误，
（误差的10%）。你应该随机选择开发集中的10%，并把它们放到我们叫做*Eyeball dev set*中来提醒我们自己我们用自己的眼睛来看他
（对于一个语音识别工程，你可能会听到语音片段，你可能叫这个集合为耳朵开发集）。眼球开发集因此有了500个样例，
我们预期的算法能够误分类100个的集合。

开发集的第二个子集，叫做黑盒子开发集，会有剩下的4500个样例。你能够使用黑盒子开发集通过分类器的误差率来评估他们，
你也能够使用它来在算法中选择或调试参数。然而，你应该避免用你的眼睛来看他。我们使用名词“黑盒子”是因为我们只是
使用这个数据子集来获得分类器评估的"黑盒子"。

我们为什么要把开发集确切的分隔成眼球和黑盒子开发集呢？因为你会从研究开发集中得到指导，你会很快在眼球开发集中过拟合。
如果你发现在眼球开发集上的性能提升比在黑盒子上的性能提升更快的话，你过拟合了眼球开发集。这种情况下，你需要丢弃他，
并通过从黑盒子集中移动样例到眼球机中或添加新的标记好的数据来形成一个新的眼球开发集。

把你的开发集确切的分成眼球和黑盒子开发集允许你辨别什么时候你的手工误差分析导致你过拟合了数据的眼球部分。



# 18、眼球和黑盒子开发集应该多大？

你的眼球开发集应该足够大来使你对你的算法的主要误差类别有一个感觉。如果你在一个人们做的很好地任务上工作
（例如识别图片中的猫咪），这里有一些简陋的指导：

- 你的分类器造成的10个误差的一个眼球开发集能够被认为是很小的。只有10个误差，很难确切的估计不同误差类别的影响。
但是如果你有一个很小的数据并不能支持添加更多的数据到眼球开发集中，聊胜于无也会帮助工程的优化。

- 如果你的分类器在眼球开发样例中有20个错误，你应该开始得到一个简单的对于主要误差源的感觉。

- 有了50个错误，你应该对于主要误差源有一个好的认识

- 有100个错误，你应该对主要误差源有一个非常好的认识。我曾经见过人们手动分析更多的误差-有时达到500个。
只要你有足够多的数据，这是无害的。

假定你的分类器有5%的误差率。为了确保你在眼球开发集中有100个错误标记的样例，眼球开发集需要有2000个左右的样例。
（0.05\*2000=100）。你的分类器错误率越低，你的眼球开发集就该越高来得到足够大的误差集合进行分析。

如果你你工作的任务，人类也不能做的很好，那么检查眼球开发集也不会有用，因为很难搞清楚为什么算法不能正确对一个样例进行分类。
在这种情况下，你应该忽略掉眼球开发集。我们在后续章节来对这种问题的讨论指南。

那么对于黑盒子开发集应该怎样呢？我们先前说开发集有1000-10000个样例很正常。为了精炼这个说法，
对于1000-10000个样例的黑盒子开发集会经常给你足够的数据来调试超参数和在模型中选择，尽管有更多的数据也是无害的。
一个有100个样例的黑盒子开发集是小的但是仍旧有用。

如果你有一个小的开发集，那么你可能没有足够的数据来分割成足够大的能服务他们的目标的眼球和黑盒子开发集。反而，
你的整个开发集可能必须被用作眼球开发集，即你可能会手动的检测所有的开发集数据。

在眼球和黑盒子开发集之间，我认为眼球开发集更重要（假设你在一个人类能很好解决的问题上工作，你能进行误差分析并且
检查这些样例能帮你获得深刻见解）。如果你只有眼球开发集，你能对整个数据集进行误差分析，模型选择和超参数调试。
只有眼球集的缺点就是对于开发集的过拟合风险更大了。

如果你有很多得到数据的方法，那么眼球开发集的大小就主要被你有多少时间来手动的分析样例来决定。例如，我曾经
见过有人手动的分析超过1000个错误。


# 19、总结：基本误差分析

- 当你开始一个新的工程的时候，尤其是这个领域你不是专家，很难去正确的猜测最有前景的方向。

- 不要一开始就尝试设计和构建最完美的系统。相反，尽快的构建和训练一个基本的系统-可能只需要用几天。
接着使用误差分析来帮你辨别最有前景的方向和据此多次重复提升你的算法。

- 手动的尝试误差分析-100个算法误分类的开发集样例和计算最主要的误差类别。使用这个信息来决定优先修改哪种误差。

- 考虑分隔开发集为你会手动检测的眼球开发集，和不用手动检测的黑盒子开发集。如果眼球开发集的性能比黑盒子开发集的好，
你过拟合了眼球开发集并应该考虑为它多增加点数据。

- 眼球开发集应该足够大以至于你的算法错误分类足够的样例给你进行分析。一个1000-10000个样例的黑盒子开发集对于
很多的应用来说，是足够的。


- 如果你的开发集不够大来按照这种方法切分，只对手动误差分析、模型选择和超参数调试使用一个眼球开发集。